openapi: 3.0.1
info:
  title: Kates API
  version: 1.0.0
servers:
  - url: http://localhost:4000
paths:
  /albums:
    get:
      summary: Get all albums
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Album'
    post:
      summary: Create new album
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlbumCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Album'
        '400':
          description: Bad request (missing fields)
        '401':
          description: Unauthorized (guest cannot create)
  /albums/{id}:
    get:
      summary: Get album by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Album'
        '404':
          description: Album not found
    put:
      summary: Update album
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlbumCreate'
      responses:
        '200':
          description: Updated
        '403':
          description: Forbidden (not owner/admin)
        '404':
          description: Album not found
    delete:
      summary: Delete album
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Deleted
        '403':
          description: Forbidden
        '404':
          description: Album not found

  /albums/{id}/photos:
    get:
      summary: Get all photos in an album
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Photo'

  /photos:
    get:
      summary: Get all photos
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Photo'
    post:
      summary: Create a photo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PhotoCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Photo'
        '400':
          description: Missing fields
        '401':
          description: Unauthorized
        '404':
          description: Album not found
        '422':
          description: Invalid image URL
  /photos/{id}:
    get:
      summary: Get photo by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Photo'
        '404':
          description: Photo not found
    put:
      summary: Update photo
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PhotoUpdate'
      responses:
        '200':
          description: Updated
        '403':
          description: Forbidden
        '404':
          description: Photo not found
        '422':
          description: Invalid image URL
    delete:
      summary: Delete photo
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Deleted
        '403':
          description: Forbidden
        '404':
          description: Photo not found

  /photos/{id}/comments:
    get:
      summary: Get comments for photo
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'

  /comments:
    get:
      summary: Get all comments
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
    post:
      summary: Create comment
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreate'
      responses:
        '201':
          description: Created
        '400':
          description: Missing fields
        '401':
          description: Unauthorized

  /comments/{id}:
    get:
      summary: Get comment by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
        '404':
          description: Comment not found
    put:
      summary: Update comment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreate'
      responses:
        '200':
          description: Updated
        '403':
          description: Forbidden
        '404':
          description: Comment not found
    delete:
      summary: Delete comment
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Deleted
        '403':
          description: Forbidden
        '404':
          description: Comment not found

components:
  schemas:
    Album:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        userId:
          type: integer
    AlbumCreate:
      type: object
      required:
        - title
      properties:
        title:
          type: string
        description:
          type: string
    Photo:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        imageUrl:
          type: string
        albumId:
          type: integer
        uploadedById:
          type: integer
    PhotoCreate:
      type: object
      required:
        - title
        - imageUrl
        - albumId
      properties:
        title:
          type: string
        description:
          type: string
        imageUrl:
          type: string
        albumId:
          type: integer
    PhotoUpdate:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        imageUrl:
          type: string
    Comment:
      type: object
      properties:
        id:
          type: integer
        content:
          type: string
        userId:
          type: integer
        photoId:
          type: integer
    CommentCreate:
      type: object
      required:
        - content
        - photoId
      properties:
        content:
          type: string
        photoId:
          type: integer
