openapi: 3.0.1
info:
  title: Kačiukų forumo API
  version: 1.0.0
  description: >
    API kačiukų albumų, nuotraukų ir komentarų valdymui.
    Autentifikacija paremta JWT access + refresh tokenais.
servers:
  - url: http://localhost:4000
    description: Local development

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        role:
          type: string
          description: Naudotojo rolė (guest/member/admin)

    AuthRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
        password:
          type: string

    RegisterRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
        email:
          type: string
        password:
          type: string

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        accessToken:
          type: string
        refreshToken:
          type: string

    RefreshRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string

    TokenPair:
      type: object
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string

    LogoutRequest:
      type: object
      required:
        - refreshToken
      properties:
        refreshToken:
          type: string

    Album:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        userId:
          type: integer

    AlbumCreate:
      type: object
      required:
        - title
      properties:
        title:
          type: string
        description:
          type: string

    Photo:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        description:
          type: string
        imageUrl:
          type: string
        albumId:
          type: integer
        uploadedById:
          type: integer

    PhotoCreate:
      type: object
      required:
        - title
        - imageUrl
        - albumId
      properties:
        title:
          type: string
        description:
          type: string
        imageUrl:
          type: string
        albumId:
          type: integer

    Comment:
      type: object
      properties:
        id:
          type: integer
        content:
          type: string
        userId:
          type: integer
        photoId:
          type: integer

    CommentCreate:
      type: object
      required:
        - content
        - photoId
      properties:
        content:
          type: string
        photoId:
          type: integer

paths:
  ############################
  # Auth
  ############################
  /auth/register:
    post:
      summary: Registracija
      description: Sukuria naują member naudotoją ir grąžina access + refresh tokenus.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Sukurtas naudotojas ir tokenai
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Blogas prašymas (trūksta laukų)
        '409':
          description: El. paštas jau naudojamas

  /auth/login:
    post:
      summary: Prisijungimas
      description: Patikrina email ir slaptažodį, grąžina access + refresh tokenus.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        '200':
          description: Sėkmingas prisijungimas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Blogas prašymas
        '401':
          description: Neteisingi prisijungimo duomenys

  /auth/refresh:
    post:
      summary: Atnaujinti access tokeną
      description: >
        Priima refreshToken, patikrina jį, rotuoja ir grąžina naujus access + refresh tokenus.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshRequest'
      responses:
        '200':
          description: Nauji tokenai
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenPair'
        '400':
          description: Trūksta refreshToken
        '401':
          description: Neteisingas ar pasibaigęs refresh tokenas

  /auth/logout:
    post:
      summary: Atsijungimas
      description: >
        Anuliuoja pateiktą refreshToken (jei validus) ir pažymi kaip revoked DB pusėje.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '200':
          description: Atsijungta sėkmingai
        '400':
          description: Trūksta refreshToken

  ############################
  # Albums
  ############################
  /albums:
    get:
      summary: Gauti visus albumus
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Album'
    post:
      summary: Sukurti naują albumą
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlbumCreate'
      responses:
        '201':
          description: Albumas sukurtas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Album'
        '400':
          description: Blogas payload
        '401':
          description: Neautorizuota
        '403':
          description: Neturi teisių

  /albums/{id}:
    get:
      summary: Gauti albumą pagal ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Album'
        '404':
          description: Albumas nerastas
    put:
      summary: Atnaujinti albumą
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlbumCreate'
      responses:
        '200':
          description: Atnaujintas
        '400':
          description: Blogas payload
        '401':
          description: Neautorizuota
        '403':
          description: Neturi teisių
        '404':
          description: Albumas nerastas
    delete:
      summary: Ištrinti albumą
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Ištrinta
        '401':
          description: Neautorizuota
        '403':
          description: Neturi teisių
        '404':
          description: Albumas nerastas

  /albums/{id}/photos:
    get:
      summary: Gauti albumo nuotraukas
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Photo'
        '404':
          description: Albumas nerastas (jei taip padarysi controller'yje)

  ############################
  # Photos
  ############################
  /photos:
    get:
      summary: Gauti visas nuotraukas
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Photo'
    post:
      summary: Sukurti nuotrauką
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PhotoCreate'
      responses:
        '201':
          description: Sukurta nuotrauka
        '400':
          description: Blogas payload
        '401':
          description: Neautorizuota
        '404':
          description: Albumas nerastas

  /photos/{id}:
    get:
      summary: Gauti nuotrauką pagal ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Photo'
        '404':
          description: Nuotrauka nerasta
    put:
      summary: Atnaujinti nuotrauką
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PhotoCreate'
      responses:
        '200':
          description: Atnaujinta
        '400':
          description: Blogas payload
        '401':
          description: Neautorizuota
        '403':
          description: Neturi teisių
        '404':
          description: Nuotrauka nerasta
    delete:
      summary: Ištrinti nuotrauką
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Ištrinta
        '401':
          description: Neautorizuota
        '403':
          description: Neturi teisių
        '404':
          description: Nuotrauka nerasta

  /photos/{id}/comments:
    get:
      summary: Gauti nuotraukos komentarus
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
        '404':
          description: Nuotrauka nerasta (jei taip darai controller'yje)

  ############################
  # Comments
  ############################
  /comments:
    get:
      summary: Gauti visus komentarus
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
    post:
      summary: Sukurti komentarą
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreate'
      responses:
        '201':
          description: Sukurtas
        '400':
          description: Blogas payload
        '401':
          description: Neautorizuota
        '404':
          description: Nuotrauka nerasta

  /comments/{id}:
    get:
      summary: Gauti komentarą pagal ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '404':
          description: Komentaras nerastas
    put:
      summary: Atnaujinti komentarą
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CommentCreate'
      responses:
        '200':
          description: Atnaujintas
        '400':
          description: Blogas payload
        '401':
          description: Neautorizuota
        '403':
          description: Neturi teisių
        '404':
          description: Komentaras nerastas
    delete:
      summary: Ištrinti komentarą
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Ištrintas
        '401':
          description: Neautorizuota
        '403':
          description: Neturi teisių
        '404':
          description: Komentaras nerastas
